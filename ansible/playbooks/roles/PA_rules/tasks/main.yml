---

- name: Get running nat-policy
  paloaltonetworks.panos.panos_op:
    provider: '{{ palo_provider }}'
    cmd: 'show running nat-policy'
  register: nat_policy_raw

- name: Convert NAT policy string to structured data
  set_fact:
    nat_policy_lines: "{{ nat_policy_raw.stdout_lines | list }}"

- name: Process each NAT policy entry
  set_fact:
    nat_policies: "{{ nat_policies | default([]) + [item] }}"
  loop: "{{ nat_policy_lines }}"
  #when: item | regex_search('^\"VM1-PA-')  # Adjust this regex based on the actual format of your policies

- name: Display each NAT policy
  debug:
    var: item | to_nice_json
  loop: "{{ nat_policies }}"