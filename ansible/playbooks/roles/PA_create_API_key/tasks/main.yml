---

- name: Create PA APi Key
  ansible.builtin.uri:
    url: https://198.20.64.216/api/\?type\=keygen
    method: POST
    body_format: form-urlencoded
    body:
    - [ user, '{{username}}']
    - [ password, '{{pass}}']
    validate_certs: false
    return_content: true
  register: login

- name: Parse key from XML response
  set_fact:
    api_key: "{{ login.content | ansible.utils.from_xml | json_query('response.result.key') }}"

- name: Print key
  debug:
    var: api_key